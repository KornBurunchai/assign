<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ตะกร้าสินค้า </title>
      <!-- font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anuphan:wght@100..700&display=swap" rel="stylesheet">
    <!-- font -->
    <link rel="stylesheet" href="/css/index.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="../css/cart_css.css" />
    <link rel="icon" href="/img/logo1.png" type="image/png">
  </head>

  <body>
    <section class="navbar">
      <ul>
        <li><a href="../index.html">หน้าหลัก</a></li>
        <li><a href="product.html">สินค้า</a></li>
        <li><a href="cart.html">ตะกร้าสินค้า</a></li>
        <li><a href="confirm-payment.html">คำสั่งซื้อ</a></li>
      </ul>
    </section>
    
    <section class="all_body">

      <!-- Container -->
      <div class="container">
        <section class="cret-table" style="overflow: auto;">
          <table class="cart-table">
            <thead>
              <tr>
                <th>รูปสินค้า</th>
                <th>รายการสินค้า</th>
                <th>ราคา</th>
                <th>จำนวน</th>
                <th>ราคารวม</th>
                <th>แก้ไข</th>
              </tr>
            </thead>
            <tbody class="cart-container">
              <!-- รายการสินค้าจะแสดงที่นี่ -->
            </tbody>
          </table>
        </section>
      </div>

      <div class="total-section">
        ยอดรวมสินค้า: <span id="total-price">฿0.00</span>
      </div>
      <div class="next-button-section">
        <a href="shipping.html" class="next-button">ต่อไป</a>
      </div>
    </section>

    <script>
      // เมื่อโหลดหน้าเว็บเสร็จสิ้นให้แสดงสินค้าจาก localStorage
      window.addEventListener("DOMContentLoaded", function () {
        let cart = localStorage.getItem("cart")
          ? JSON.parse(localStorage.getItem("cart"))
          : [];

        // เรียกใช้ฟังก์ชันเพื่อแสดงตะกร้าสินค้า
        updateCartDisplay(cart);
      });

      // ฟังก์ชันเพิ่ม/ลดจำนวนสินค้า หรือลบสินค้า
      document
        .querySelector(".cart-table")
        .addEventListener("click", function (e) {
          let cart = localStorage.getItem("cart")
            ? JSON.parse(localStorage.getItem("cart"))
            : [];

          if (e.target.classList.contains("increase")) {
            let index = e.target.getAttribute("data-index");
            cart[index].quantity += 1;
            localStorage.setItem("cart", JSON.stringify(cart));
            updateCartDisplay(cart);
          }

          if (e.target.classList.contains("decrease")) {
            let index = e.target.getAttribute("data-index");
            if (cart[index].quantity > 1) {
              cart[index].quantity -= 1;
              localStorage.setItem("cart", JSON.stringify(cart));
              updateCartDisplay(cart);
            }
          }

          if (e.target.classList.contains("delete-icon")) {
            let index = e.target.getAttribute("data-index");
            cart.splice(index, 1);
            localStorage.setItem("cart", JSON.stringify(cart));
            updateCartDisplay(cart);
          }
        });

      // ฟังก์ชันสำหรับอัปเดตการแสดงผลของตะกร้า
      function updateCartDisplay(cart) {
        let cartTableBody = document.querySelector(".cart-table tbody");
        cartTableBody.innerHTML = ""; // เคลียร์เนื้อหาก่อน

        let total = 0;
        if (cart.length === 0) {
          let emptyRow = document.createElement("tr");
          emptyRow.innerHTML = `
        <td colspan="6" style="text-align: center;">ไม่มีสินค้าในตะกร้า</td>
    `;
          cartTableBody.appendChild(emptyRow);
        } else {
          // ถ้ามีสินค้าในตะกร้า ให้แสดงสินค้า
          cart.forEach(function (product, index) {
            let row = document.createElement("tr");
            row.innerHTML = `
            <td>
                <img src="${product.image}" alt="${product.image}" 
                style="max-height: 150px; max-width: 200px; margin-right: 5rem;">
            </td>
            <td>
                <span>${product.name}</span>
            </td>
            <td>฿${product.price}</td>
            <td>
                <div class="quantity-selector">
                    <button class="decrease" data-index="${index}">-</button>
                    <input type="text" value="${product.quantity}" readonly>
                    <button class="increase" data-index="${index}">+</button>
                </div>
            </td>
            <td>฿${(product.price * product.quantity).toFixed(2)}</td>
            <td>
                <img src="../img/delete.png" alt="ลบสินค้า" class="delete-icon" data-index="${index}">
            </td>
        `;
            cartTableBody.appendChild(row);
            total += product.price * product.quantity;
          });
        }
        let totalSection = document.querySelector(".total-section");
        totalSection.innerHTML = `ยอดรวมสินค้า: ฿${total.toFixed(2)} บาท`;
      }
      // เพิ่มปุ่มสำหรับไปยังหน้าชำระเงิน
      document
        .querySelector(".next-button")
        .addEventListener("click", function () {
          let cart = localStorage.getItem("cart")
            ? JSON.parse(localStorage.getItem("cart"))
            : [];
          localStorage.setItem("checkoutCart", JSON.stringify(cart)); // เก็บข้อมูลลงใน localStorage
          window.location.href = "shipping.htm"; // ไปยังหน้าชำระเงิน
        });
    </script>

    <footer>
      <p>&copy; 2024 ร้านค้าออนไลน์. สงวนลิขสิทธิ์.</p>
    </footer>
  </body>
</html>
